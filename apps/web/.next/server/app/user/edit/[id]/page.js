(()=>{var e={};e.id=1069,e.ids=[1069],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},84170:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>u,routeModule:()=>x,tree:()=>d});var t=r(76427),a=r(7953),i=r(35145),n=r.n(i),o=r(15288),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(s,l);let c=t.AppPageRouteModule,d=["",{children:["user",{children:["edit",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3785)),"/Users/joshuabender/Documents/GitHub/ticketing/apps/web/app/user/edit/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,47442)),"/Users/joshuabender/Documents/GitHub/ticketing/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,23310)),"/Users/joshuabender/Documents/GitHub/ticketing/apps/web/app/not-found.tsx"]}],u=["/Users/joshuabender/Documents/GitHub/ticketing/apps/web/app/user/edit/[id]/page.tsx"],m="/user/edit/[id]/page",p={require:r,loadChunk:()=>Promise.resolve()},x=new c({definition:{kind:a.x.APP_PAGE,page:"/user/edit/[id]/page",pathname:"/user/edit/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},51899:(e,s,r)=>{Promise.resolve().then(r.bind(r,75289)),Promise.resolve().then(r.t.bind(r,94573,23))},75289:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>ProfilePage});var t=r(82395),a=r(23279),i=r(78726),n=r.n(i),o=r(46638),l=r(32684),c=r(83296),d=r(89891),u=r(51892),m=r(42341),p=r(28746),x=r(89669),h=r(74555),g=r(11702),f=r(86417);let j=c.Ry({username:c.Z_().min(2,{message:"Username must be at least 2 characters."}).regex(/^[a-zA-Z0-9_\-]+$/,{message:"Your username can contain letters, numbers, _ and -"}).max(30,{message:"Username must not be longer than 30 characters."}),firstname:c.Z_().max(30,{message:"First name must not be longer than 30 characters."}).regex(/^[a-zA-Z]*$/,{message:"Must not contain spaces or special characters"}).optional(),lastname:c.Z_().max(30,{message:"Last name must not be longer than 30 characters."}).regex(/^[a-zA-Z]*$/,{message:"Must not contain spaces or special characters"}).optional(),bio:c.Z_().max(160).optional()});function nullToUndefined(e){return e??void 0}function ProfileForm({userProfile:e}){let s=(0,h.useRouter)(),[r,a]=i.useState(!1),n=f.S.updateUser.useMutation({onSettled(e,r){e?(s.refresh(),(0,x.Am)({description:"Profile updated successfully!"})):((0,x.Am)({variant:"destructive",description:"Error updating profile"}),console.error("Error updating profile:",r)),a(!1)}}),c={bio:nullToUndefined(e.bio),first_name:nullToUndefined(e.first_name),id:e.id,last_name:nullToUndefined(e.last_name),profile_image:nullToUndefined(e.profile_image),username:nullToUndefined(e.username)},b={username:c.username,firstname:c.first_name,lastname:c.last_name,bio:c.bio},v=(0,l.cI)({resolver:(0,o.F)(j),defaultValues:b,mode:"onChange"});async function onSubmit(e){a(!0),n.mutate({id:c.id,username:""===e.username?null:e.username??null,first_name:""===e.firstname?null:e.firstname??null,last_name:""===e.lastname?null:e.lastname??null,bio:""===e.bio?null:e.bio??null})}return t.jsx("div",{children:t.jsx(u.l0,{...v,children:(0,t.jsxs)("form",{onSubmit:v.handleSubmit(onSubmit),className:"space-y-8",children:[t.jsx(u.Wi,{control:v.control,name:"username",render:({field:e})=>(0,t.jsxs)(u.xJ,{children:[t.jsx(u.lX,{children:"Username"}),t.jsx(u.NI,{children:t.jsx(m.I,{placeholder:"",disabled:r,...e})}),t.jsx(u.pf,{children:"This is your public display name. It can be your real name or a pseudonym."}),t.jsx(u.zG,{})]})}),t.jsx(u.Wi,{control:v.control,name:"firstname",render:({field:e})=>(0,t.jsxs)(u.xJ,{children:[t.jsx(u.lX,{children:"First Name"}),t.jsx(u.NI,{children:t.jsx(m.I,{placeholder:"",disabled:r,...e})}),t.jsx(u.zG,{})]})}),t.jsx(u.Wi,{control:v.control,name:"lastname",render:({field:e})=>(0,t.jsxs)(u.xJ,{children:[t.jsx(u.lX,{children:"Last Name"}),t.jsx(u.NI,{children:t.jsx(m.I,{placeholder:"",disabled:r,...e})}),t.jsx(u.zG,{})]})}),t.jsx(u.Wi,{control:v.control,name:"bio",render:({field:e})=>(0,t.jsxs)(u.xJ,{children:[t.jsx(u.lX,{children:"Bio"}),t.jsx(u.NI,{children:t.jsx(p.g,{placeholder:"Tell us a little bit about yourself",className:"resize-none",disabled:r,...e})}),t.jsx(u.zG,{})]})}),t.jsx("div",{}),(0,t.jsxs)(d.z,{className:"w-64",variant:"secondary",type:"submit",disabled:r,children:[r&&t.jsx(g.P.spinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Update profile"]})]})})})}var b=r(24288),v=r.n(b),y=r(56769);function SidebarNav({className:e,items:s,...r}){let a=(0,h.usePathname)();return t.jsx("nav",{className:(0,y.cn)("flex space-x-2 lg:flex-col lg:space-x-0 lg:space-y-1",e),...r,children:s.map(e=>t.jsx(v(),{href:e.href,className:(0,y.cn)((0,d.d)({variant:"ghost"}),a===e.href?"bg-muted hover:bg-muted":"hover:bg-transparent hover:underline","justify-start"),children:e.title},e.href))})}var _=r(99953),N=r(83478),w=r(20716),P=r(65590),S=r(73540),q=r(26208),U=r(15850);let{chains:k,publicClient:E,webSocketPublicClient:I}=(0,P.QB)([N.u,w.J],[(0,S.G)({apiKey:process.env.ALCHEMY_DEV_API_KEY})]),M=(0,_._g)({autoConnect:!0,connectors:[new U.i({chains:k}),new q.D({chains:k,options:{appName:"wagmi"}})],publicClient:E,webSocketPublicClient:I});var A=r(11946);let z=["jpeg"];function UserUploadImage({id:e,userImage:s,buttonText:r}){let[a,o]=n().useState(!1),[c,u]=n().useState(s),{register:p,handleSubmit:j}=(0,l.cI)(),{toast:b}=(0,x.pm)(),v=(0,h.useRouter)(),y=f.S.updateUser.useMutation({onSettled(e,s){e?(u(e.profile_image??""),v.refresh(),b({description:"Profile updated successfully!"})):(b({variant:"destructive",description:"Error updating profile"}),console.error("Error updating profile:",s)),o(!1)}});(0,i.useEffect)(()=>{u(c??"")},[c]);let onSubmit=async s=>{if(o(!0),0==s.file.length){b({variant:"destructive",description:"Must choose a file to upload!"}),o(!1);return}let r=s.file[0].name.split(".")[1];if(!z.includes(r)){b({variant:"destructive",description:"Image must be a jpeg"}),o(!1);return}let t="users",a=new FormData;a.append("file",s.file[0]),a.append("fileName",s.file[0].name),a.append("location",`/${e}/profile.jpeg`),a.append("bucket",t);try{b({description:"Uploading image..."});let s=await fetch("http://localhost:3000/api/image/upload",{method:"POST",body:a,cache:"no-store"});if(s.ok){b({description:"Image uploaded successfully!"});let r=await s.json();y.mutate({id:e,profile_image:"http://localhost:54321/storage/v1/object/public/"+t+r.location})}else{let e=await s.json();"invalid signature"==e.error.message?b({variant:"destructive",description:"Must be signed in to upload an image!"}):b({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",e.error)}o(!1)}catch(e){b({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",e),o(!1)}};return(0,t.jsxs)(t.Fragment,{children:[t.jsx("form",{onSubmit:j(onSubmit),children:(0,t.jsxs)("div",{className:"grid grid-cols-2 grid-rows-1",children:[(0,t.jsxs)(d.z,{variant:"secondary",type:"submit",disabled:a,className:"w-64",children:[a&&t.jsx(g.P.spinner,{className:"mr-2 h-4 w-4 animate-spin"}),r]}),t.jsx(m.I,{id:"picture",type:"file",disabled:a,...p("file",{onChange:e=>{u(URL.createObjectURL(e.target.files[0]))}})})]})}),""!=c?t.jsx("div",{children:t.jsx(A.Avatar,{className:"h-40 w-40",children:c?t.jsx(A.AvatarImage,{src:c,alt:"pfp"}):t.jsx(A.AvatarFallback,{})})}):t.jsx("div",{})]})}var C=r(19328),G=r.n(C),T=r(73500);function WalletConnect({userProfile:e}){let{connect:s,connectors:r,error:a,isLoading:i,pendingConnector:o}=(0,_.$4)(),{address:l,connector:c,isConnected:u}=(0,_.mA)(),{data:m}=(0,_.F6)({address:l}),{disconnect:p}=(0,_.qL)(),{chain:x}=(0,_.LN)(),{switchNetwork:h}=(0,_.g0)(),{data:g,error:j,isLoading:b,signMessage:v,variables:y}=(0,_.QW)(),N=f.S.updateUser.useMutation({onSettled(e,s){e||console.error("Error adding wallet:",s)}});return n().useEffect(()=>{(async()=>{if(y?.message&&g){let s=await (0,T.k)({message:y?.message,signature:g});s===l?N.mutate({id:e.id,wallet_address:String(s)}):console.error("Signature did not recover to correct address")}})()},[g,y?.message,l,N,e.id]),t.jsx("div",{children:u?(0,t.jsxs)("div",{className:"grid grid-cols-2",children:[(0,t.jsxs)("div",{className:"justify-self-start",children:[(0,t.jsxs)("div",{className:"py-4",children:[" ",t.jsx(d.z,{disabled:b,variant:"secondary",onClick:()=>v({message:"Please sign this message to confirm this is your wallet"}),children:b?"Check Wallet":"Sign Message"}),j&&t.jsx("div",{children:j.message})]}),(0,t.jsxs)(d.z,{className:"w-64",variant:"secondary",onClick:()=>{p()},children:["Disconnect",c?.name==="MetaMask"?t.jsx(G(),{src:"/metamask.png",alt:"image",width:500,height:500,className:"h-full w-8 object-cover object-center pl-2 group-hover:opacity-75"}):t.jsx(G(),{src:"/coinbase.png",alt:"image",width:200,height:200,className:"h-full w-8 object-center pl-2 group-hover:opacity-75"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-medium",children:m?`${m} (${l})`:l?.substring(0,6)+"..."+l?.substring(l.length-4)}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Connected to ",x?.name]})]})]}):(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[r.map(e=>(0,t.jsxs)(d.z,{variant:"secondary",className:"w-64 justify-self-start",disabled:!e.ready,onClick:()=>{x?.id!=8453&&(console.log("No!"),h?.(8453)),s({connector:e})},children:[e.name,!e.ready&&" (unsupported)",i&&e.id===o?.id&&" (connecting)","MetaMask"===e.name?t.jsx(G(),{src:"/metamask.png",alt:"image",width:500,height:500,className:"h-full w-8 object-cover object-center pl-2 group-hover:opacity-75"}):t.jsx(G(),{src:"/coinbase.png",alt:"image",width:200,height:200,className:"h-full w-8 object-center pl-2 group-hover:opacity-75"})]},e.id)),a&&t.jsx("div",{children:a.message})]})})}let D=[{title:"Profile",href:"/examples/forms"},{title:"Account",href:"/examples/forms/account"},{title:"Notifications",href:"/examples/forms/notifications"}];function ProfilePage({params:e}){let{data:s,isLoading:r}=f.S.getUserProfile.useQuery({id:e.id});return t.jsx(_.eM,{config:M,children:t.jsx("div",{children:r?t.jsx("div",{children:"Loading..."}):(0,t.jsxs)("div",{className:" space-y-6 p-10 pb-16 sm:block",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Settings"}),t.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and set e-mail preferences."})]}),t.jsx(a.Separator,{className:"my-6"}),(0,t.jsxs)("div",{className:"flex flex-col space-y-8 lg:flex-row lg:space-x-12 lg:space-y-0",children:[t.jsx("aside",{className:"-mx-4 lg:w-1/5",children:t.jsx(SidebarNav,{items:D})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-medium",children:"Profile"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"This is how others will see you on the site."})]}),t.jsx(a.Separator,{}),t.jsx(ProfileForm,{userProfile:s}),t.jsx(a.Separator,{}),t.jsx("h3",{className:"text-lg font-medium",children:"Web3 Connection"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect your wallet to custody your tickets! Probably need some better explanation for users."}),t.jsx(a.Separator,{}),t.jsx(WalletConnect,{userProfile:s}),t.jsx(a.Separator,{}),t.jsx("h3",{className:"text-lg font-medium",children:"Profile Picture"}),t.jsx(a.Separator,{}),t.jsx(UserUploadImage,{id:e.id,userImage:s?.profile_image,buttonText:"Update profile picture"})]})]})]})})})}},3785:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>Home});var t=r(63326),a=r(46962);let i=(0,a.createProxy)(String.raw`/Users/joshuabender/Documents/GitHub/ticketing/apps/web/components/ProfilePage.tsx`),{__esModule:n,$$typeof:o}=i,l=i.default;var c=r(71959),d=r(43729);async function Home({params:e}){let s=(0,c.Z)(),{data:{session:r}}=await s.auth.getSession();return r?.user.id!=e.id&&(0,d.redirect)("/unauthorized"),t.jsx("main",{children:t.jsx(l,{params:{id:e.id}})})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),r=s.X(0,[8293,5105,3326,1094,3729,8032,2684,733,8173,8684,7059,278,3053,1702,4597,2311],()=>__webpack_exec__(84170));module.exports=r})();