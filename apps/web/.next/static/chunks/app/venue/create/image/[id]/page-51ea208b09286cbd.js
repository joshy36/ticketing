(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269,34,68],{60748:function(e,t,r){Promise.resolve().then(r.bind(r,89056)),Promise.resolve().then(r.bind(r,20562)),Promise.resolve().then(r.t.bind(r,89970,23))},46497:function(e,t,r){"use strict";r.d(t,{S:function(){return n}});var i=r(20695);let n=(0,i.ec)({})},20562:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return UploadImage}});var i=r(27573),n=r(7653),a=r(66342),o=r(92728),s=r(21472),u=r(37799),d=r(25381),l=r(96072),c=r.n(l),p=r(32859),g=r(46497);let f=["jpeg"];function UploadImage(e){let{params:t}=e,[r,l]=n.useState(!1),[m,b]=n.useState(""),{register:v,handleSubmit:h}=(0,a.cI)(),{toast:j}=(0,s.pm)(),x=(0,p.useRouter)(),w=g.S.updateEvent.useMutation({onSettled(e,r){e?x.push("/event/".concat(t.id)):(j({description:"Error updating event"}),console.error("Error updating event:",r),l(!1))}}),y=g.S.updateArtist.useMutation({onSettled(e,r){e?x.push("/artist/".concat(t.id)):(j({description:"Error updating artist"}),console.error("Error updating artist:",r),l(!1))}}),k=g.S.updateVenue.useMutation({onSettled(e,r){e?x.push("/venue/".concat(t.id)):(j({description:"Error updating venue"}),console.error("Error updating venue:",r),l(!1))}}),updateImage=async e=>{"events"===t.bucket?w.mutate({id:t.id,image:e}):"artists"===t.bucket?y.mutate({id:t.id,image:e}):"venues"===t.bucket&&k.mutate({id:t.id,image:e})},onSubmit=async e=>{if(l(!0),0==e.file.length){j({variant:"destructive",description:"Must choose a file to upload!"}),l(!1);return}let r=e.file[0].name.split(".")[1];if(!f.includes(r)){j({variant:"destructive",description:"Image must be a jpeg"}),l(!1);return}let i=t.bucket,n=new FormData;n.append("file",e.file[0]),n.append("fileName",e.file[0].name),"events"===i?n.append("location","/".concat(t.id,"/event_photo.jpeg")):"artists"===i?n.append("location","/".concat(t.id,"/profile.jpeg")):"venues"===i&&n.append("location","/".concat(t.id,"/profile.jpeg")),n.append("bucket",i);try{j({description:"Uploading image..."});let e=await fetch("http://localhost:3000/api/image/upload",{method:"POST",body:n,cache:"no-store"});if(e.ok){j({description:"Image uploaded successfully!"});let t=await e.json(),r="http://localhost:54321/storage/v1/object/public/"+i+t.location;await updateImage(r)}else{let t=await e.json();"invalid signature"==t.error.message?j({variant:"destructive",description:"Must be signed in to upload an image!"}):j({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",t.error)}l(!1)}catch(e){j({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",e),l(!1)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("form",{onSubmit:h(onSubmit),children:(0,i.jsxs)("div",{className:"grid grid-cols-2 grid-rows-1 gap-8",children:[(0,i.jsx)(u.I,{id:"picture",type:"file",disabled:r,...v("file",{onChange:e=>{b(URL.createObjectURL(e.target.files[0]))}})}),(0,i.jsxs)(o.z,{type:"submit",disabled:r,className:"max-w-[40%]",children:[r&&(0,i.jsx)(d.P.spinner,{className:"mr-2 h-4 w-4 animate-spin"}),"events"===t.bucket?"Create Event":"artists"===t.bucket?"Create Artist":"venues"===t.bucket?"Create Venue":""]})]})}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{children:""===m?(0,i.jsx)("div",{}):(0,i.jsx)("div",{children:(0,i.jsx)(c(),{src:m,alt:"Image",width:300,height:300,className:"rounded-lg"})})})]})}},37799:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var i=r(27573),n=r(7653),a=r(94619);let o=n.forwardRef((e,t)=>{let{className:r,type:n,...o}=e;return(0,i.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},89056:function(e,t,r){"use strict";r.r(t),r.d(t,{Separator:function(){return s}});var i=r(27573),n=r(7653),a=r(42530),o=r(94619);let s=n.forwardRef((e,t)=>{let{className:r,orientation:n="horizontal",decorative:s=!0,...u}=e;return(0,i.jsx)(a.f,{ref:t,decorative:s,orientation:n,className:(0,o.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",r),...u})});s.displayName=a.f.displayName},78386:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return u},unstable_getImgProps:function(){return unstable_getImgProps}});let i=r(87675),n=r(19167),a=r(59378),o=r(16116),s=i._(r(90752)),unstable_getImgProps=e=>{(0,a.warnOnce)("Warning: unstable_getImgProps() is experimental and may change or be removed at any time. Use at your own risk.");let{props:t}=(0,n.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}},u=o.Image},96072:function(e,t,r){e.exports=r(78386)}},function(e){e.O(0,[37,110,116,893,377,293,858,560],function(){return e(e.s=60748)}),_N_E=e.O()}]);