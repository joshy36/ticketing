(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{35512:function(e,r,s){Promise.resolve().then(s.bind(s,15270)),Promise.resolve().then(s.t.bind(s,89970,23))},46497:function(e,r,s){"use strict";s.d(r,{S:function(){return a}});var t=s(20695);let a=(0,t.ec)({})},15270:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return ProfilePage}});var t=s(27573),a=s(89056),n=s(7653),i=s(95536),l=s(66342),o=s(68449),d=s(92728),c=s(5019),u=s(37799),m=s(93598),f=s(21472),p=s(32859),x=s(25381),g=s(46497);let h=o.Ry({username:o.Z_().min(2,{message:"Username must be at least 2 characters."}).regex(/^[a-zA-Z0-9_\-]+$/,{message:"Your username can contain letters, numbers, _ and -"}).max(30,{message:"Username must not be longer than 30 characters."}),firstname:o.Z_().max(30,{message:"First name must not be longer than 30 characters."}).regex(/^[a-zA-Z]*$/,{message:"Must not contain spaces or special characters"}).optional(),lastname:o.Z_().max(30,{message:"Last name must not be longer than 30 characters."}).regex(/^[a-zA-Z]*$/,{message:"Must not contain spaces or special characters"}).optional(),bio:o.Z_().max(160).optional()});function nullToUndefined(e){return null!=e?e:void 0}function undefinedToNull(e){return null!=e?e:null}function ProfileForm(e){let{userProfile:r}=e,s=(0,p.useRouter)(),[a,o]=n.useState(!1),j=g.S.updateUser.useMutation({onSettled(e,r){e?(s.refresh(),(0,f.Am)({description:"Profile updated successfully!"})):((0,f.Am)({variant:"destructive",description:"Error updating profile"}),console.error("Error updating profile:",r)),o(!1)}}),v={bio:nullToUndefined(r.bio),first_name:nullToUndefined(r.first_name),id:r.id,last_name:nullToUndefined(r.last_name),profile_image:nullToUndefined(r.profile_image),username:nullToUndefined(r.username)},b={username:v.username,firstname:v.first_name,lastname:v.last_name,bio:v.bio},N=(0,l.cI)({resolver:(0,i.F)(h),defaultValues:b,mode:"onChange"});async function onSubmit(e){o(!0),j.mutate({id:v.id,username:""===e.username?null:undefinedToNull(e.username),first_name:""===e.firstname?null:undefinedToNull(e.firstname),last_name:""===e.lastname?null:undefinedToNull(e.lastname),bio:""===e.bio?null:undefinedToNull(e.bio)})}return(0,t.jsx)("div",{children:(0,t.jsx)(c.l0,{...N,children:(0,t.jsxs)("form",{onSubmit:N.handleSubmit(onSubmit),className:"space-y-8",children:[(0,t.jsx)(c.Wi,{control:N.control,name:"username",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.xJ,{children:[(0,t.jsx)(c.lX,{children:"Username"}),(0,t.jsx)(c.NI,{children:(0,t.jsx)(u.I,{placeholder:"",disabled:a,...r})}),(0,t.jsx)(c.pf,{children:"This is your public display name. It can be your real name or a pseudonym."}),(0,t.jsx)(c.zG,{})]})}}),(0,t.jsx)(c.Wi,{control:N.control,name:"firstname",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.xJ,{children:[(0,t.jsx)(c.lX,{children:"First Name"}),(0,t.jsx)(c.NI,{children:(0,t.jsx)(u.I,{placeholder:"",disabled:a,...r})}),(0,t.jsx)(c.zG,{})]})}}),(0,t.jsx)(c.Wi,{control:N.control,name:"lastname",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.xJ,{children:[(0,t.jsx)(c.lX,{children:"Last Name"}),(0,t.jsx)(c.NI,{children:(0,t.jsx)(u.I,{placeholder:"",disabled:a,...r})}),(0,t.jsx)(c.zG,{})]})}}),(0,t.jsx)(c.Wi,{control:N.control,name:"bio",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.xJ,{children:[(0,t.jsx)(c.lX,{children:"Bio"}),(0,t.jsx)(c.NI,{children:(0,t.jsx)(m.g,{placeholder:"Tell us a little bit about yourself",className:"resize-none",disabled:a,...r})}),(0,t.jsx)(c.zG,{})]})}}),(0,t.jsx)("div",{}),(0,t.jsxs)(d.z,{className:"w-64",variant:"secondary",type:"submit",disabled:a,children:[a&&(0,t.jsx)(x.P.spinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Update profile"]})]})})})}var j=s(2056),v=s.n(j),b=s(94619);function SidebarNav(e){let{className:r,items:s,...a}=e,n=(0,p.usePathname)();return(0,t.jsx)("nav",{className:(0,b.cn)("flex space-x-2 lg:flex-col lg:space-x-0 lg:space-y-1",r),...a,children:s.map(e=>(0,t.jsx)(v(),{href:e.href,className:(0,b.cn)((0,d.d)({variant:"ghost"}),n===e.href?"bg-muted hover:bg-muted":"hover:bg-transparent hover:underline","justify-start"),children:e.title},e.href))})}var N=s(89936),y=s(61745),w=s(72638),F=s(46148),S=s(92799),_=s(85797),I=s(26349),k=s(68571);let{chains:P,publicClient:C,webSocketPublicClient:U}=(0,F.QB)([y.u,w.J],[(0,S.G)({apiKey:k.env.ALCHEMY_DEV_API_KEY})]),E=(0,N._g)({autoConnect:!0,connectors:[new I.i({chains:P}),new _.D({chains:P,options:{appName:"wagmi"}})],publicClient:C,webSocketPublicClient:U});var R=s(38813);let M=["jpeg"];function UserUploadImage(e){let{id:r,userImage:s,buttonText:a}=e,[i,o]=n.useState(!1),[c,m]=n.useState(s),{register:h,handleSubmit:j}=(0,l.cI)(),{toast:v}=(0,f.pm)(),b=(0,p.useRouter)(),N=g.S.updateUser.useMutation({onSettled(e,r){if(e){var s;m(null!==(s=e.profile_image)&&void 0!==s?s:""),b.refresh(),v({description:"Profile updated successfully!"})}else v({variant:"destructive",description:"Error updating profile"}),console.error("Error updating profile:",r);o(!1)}});(0,n.useEffect)(()=>{m(null!=c?c:"")},[c]);let onSubmit=async e=>{if(o(!0),0==e.file.length){v({variant:"destructive",description:"Must choose a file to upload!"}),o(!1);return}let s=e.file[0].name.split(".")[1];if(!M.includes(s)){v({variant:"destructive",description:"Image must be a jpeg"}),o(!1);return}let t="users",a=new FormData;a.append("file",e.file[0]),a.append("fileName",e.file[0].name),a.append("location","/".concat(r,"/profile.jpeg")),a.append("bucket",t);try{v({description:"Uploading image..."});let e=await fetch("http://localhost:3000/api/image/upload",{method:"POST",body:a,cache:"no-store"});if(e.ok){v({description:"Image uploaded successfully!"});let s=await e.json();N.mutate({id:r,profile_image:"http://localhost:54321/storage/v1/object/public/"+t+s.location})}else{let r=await e.json();"invalid signature"==r.error.message?v({variant:"destructive",description:"Must be signed in to upload an image!"}):v({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",r.error)}o(!1)}catch(e){v({variant:"destructive",description:"Error uploading image!"}),console.error("Error uploading image:",e),o(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("form",{onSubmit:j(onSubmit),children:(0,t.jsxs)("div",{className:"grid grid-cols-2 grid-rows-1",children:[(0,t.jsxs)(d.z,{variant:"secondary",type:"submit",disabled:i,className:"w-64",children:[i&&(0,t.jsx)(x.P.spinner,{className:"mr-2 h-4 w-4 animate-spin"}),a]}),(0,t.jsx)(u.I,{id:"picture",type:"file",disabled:i,...h("file",{onChange:e=>{m(URL.createObjectURL(e.target.files[0]))}})})]})}),""!=c?(0,t.jsx)("div",{children:(0,t.jsx)(R.Avatar,{className:"h-40 w-40",children:c?(0,t.jsx)(R.AvatarImage,{src:c,alt:"pfp"}):(0,t.jsx)(R.AvatarFallback,{})})}):(0,t.jsx)("div",{})]})}var T=s(96072),z=s.n(T),A=s(87247);function WalletConnect(e){let{userProfile:r}=e,{connect:s,connectors:a,error:i,isLoading:l,pendingConnector:o}=(0,N.$4)(),{address:c,connector:u,isConnected:m}=(0,N.mA)(),{data:f}=(0,N.F6)({address:c}),{disconnect:p}=(0,N.qL)(),{chain:x}=(0,N.LN)(),{switchNetwork:h}=(0,N.g0)(),{data:j,error:v,isLoading:b,signMessage:y,variables:w}=(0,N.QW)(),F=g.S.updateUser.useMutation({onSettled(e,r){e||console.error("Error adding wallet:",r)}});return n.useEffect(()=>{(async()=>{if((null==w?void 0:w.message)&&j){let e=await (0,A.k)({message:null==w?void 0:w.message,signature:j});e===c?F.mutate({id:r.id,wallet_address:String(e)}):console.error("Signature did not recover to correct address")}})()},[j,null==w?void 0:w.message,c,F,r.id]),(0,t.jsx)("div",{children:m?(0,t.jsxs)("div",{className:"grid grid-cols-2",children:[(0,t.jsxs)("div",{className:"justify-self-start",children:[(0,t.jsxs)("div",{className:"py-4",children:[" ",(0,t.jsx)(d.z,{disabled:b,variant:"secondary",onClick:()=>y({message:"Please sign this message to confirm this is your wallet"}),children:b?"Check Wallet":"Sign Message"}),v&&(0,t.jsx)("div",{children:v.message})]}),(0,t.jsxs)(d.z,{className:"w-64",variant:"secondary",onClick:()=>{p()},children:["Disconnect",(null==u?void 0:u.name)==="MetaMask"?(0,t.jsx)(z(),{src:"/metamask.png",alt:"image",width:500,height:500,className:"h-full w-8 object-cover object-center pl-2 group-hover:opacity-75"}):(0,t.jsx)(z(),{src:"/coinbase.png",alt:"image",width:200,height:200,className:"h-full w-8 object-center pl-2 group-hover:opacity-75"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:f?"".concat(f," (").concat(c,")"):(null==c?void 0:c.substring(0,6))+"..."+(null==c?void 0:c.substring(c.length-4))}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Connected to ",null==x?void 0:x.name]})]})]}):(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[a.map(e=>(0,t.jsxs)(d.z,{variant:"secondary",className:"w-64 justify-self-start",disabled:!e.ready,onClick:()=>{(null==x?void 0:x.id)!=8453&&(console.log("No!"),null==h||h(8453)),s({connector:e})},children:[e.name,!e.ready&&" (unsupported)",l&&e.id===(null==o?void 0:o.id)&&" (connecting)","MetaMask"===e.name?(0,t.jsx)(z(),{src:"/metamask.png",alt:"image",width:500,height:500,className:"h-full w-8 object-cover object-center pl-2 group-hover:opacity-75"}):(0,t.jsx)(z(),{src:"/coinbase.png",alt:"image",width:200,height:200,className:"h-full w-8 object-center pl-2 group-hover:opacity-75"})]},e.id)),i&&(0,t.jsx)("div",{children:i.message})]})})}let L=[{title:"Profile",href:"/examples/forms"},{title:"Account",href:"/examples/forms/account"},{title:"Notifications",href:"/examples/forms/notifications"}];function ProfilePage(e){let{params:r}=e,{data:s,isLoading:n}=g.S.getUserProfile.useQuery({id:r.id});return(0,t.jsx)(N.eM,{config:E,children:(0,t.jsx)("div",{children:n?(0,t.jsx)("div",{children:"Loading..."}):(0,t.jsxs)("div",{className:" space-y-6 p-10 pb-16 sm:block",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Settings"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Manage your account settings and set e-mail preferences."})]}),(0,t.jsx)(a.Separator,{className:"my-6"}),(0,t.jsxs)("div",{className:"flex flex-col space-y-8 lg:flex-row lg:space-x-12 lg:space-y-0",children:[(0,t.jsx)("aside",{className:"-mx-4 lg:w-1/5",children:(0,t.jsx)(SidebarNav,{items:L})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Profile"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"This is how others will see you on the site."})]}),(0,t.jsx)(a.Separator,{}),(0,t.jsx)(ProfileForm,{userProfile:s}),(0,t.jsx)(a.Separator,{}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Web3 Connection"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Connect your wallet to custody your tickets! Probably need some better explanation for users."}),(0,t.jsx)(a.Separator,{}),(0,t.jsx)(WalletConnect,{userProfile:s}),(0,t.jsx)(a.Separator,{}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Profile Picture"}),(0,t.jsx)(a.Separator,{}),(0,t.jsx)(UserUploadImage,{id:r.id,userImage:null==s?void 0:s.profile_image,buttonText:"Update profile picture"})]})]})]})})})}},38813:function(e,r,s){"use strict";s.r(r),s.d(r,{Avatar:function(){return l},AvatarFallback:function(){return d},AvatarImage:function(){return o}});var t=s(27573),a=s(7653),n=s(91766),i=s(94619);let l=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.fC,{ref:r,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a})});l.displayName=n.fC.displayName;let o=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.Ee,{ref:r,className:(0,i.cn)("aspect-square h-full w-full",s),...a})});o.displayName=n.Ee.displayName;let d=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.NY,{ref:r,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a})});d.displayName=n.NY.displayName},5019:function(e,r,s){"use strict";s.d(r,{NI:function(){return p},Wi:function(){return FormField},l0:function(){return d},lX:function(){return f},pf:function(){return x},xJ:function(){return m},zG:function(){return g}});var t=s(27573),a=s(7653),n=s(50432),i=s(66342),l=s(94619),o=s(22062);let d=i.RV,c=a.createContext({}),FormField=e=>{let{...r}=e;return(0,t.jsx)(c.Provider,{value:{name:r.name},children:(0,t.jsx)(i.Qr,{...r})})},useFormField=()=>{let e=a.useContext(c),r=a.useContext(u),{getFieldState:s,formState:t}=(0,i.Gc)(),n=s(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=r;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},u=a.createContext({}),m=a.forwardRef((e,r)=>{let{className:s,...n}=e,i=a.useId();return(0,t.jsx)(u.Provider,{value:{id:i},children:(0,t.jsx)("div",{ref:r,className:(0,l.cn)("space-y-2",s),...n})})});m.displayName="FormItem";let f=a.forwardRef((e,r)=>{let{className:s,...a}=e,{error:n,formItemId:i}=useFormField();return(0,t.jsx)(o._,{ref:r,className:(0,l.cn)(n&&"text-destructive",s),htmlFor:i,...a})});f.displayName="FormLabel";let p=a.forwardRef((e,r)=>{let{...s}=e,{error:a,formItemId:i,formDescriptionId:l,formMessageId:o}=useFormField();return(0,t.jsx)(n.g7,{ref:r,id:i,"aria-describedby":a?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!a,...s})});p.displayName="FormControl";let x=a.forwardRef((e,r)=>{let{className:s,...a}=e,{formDescriptionId:n}=useFormField();return(0,t.jsx)("p",{ref:r,id:n,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});x.displayName="FormDescription";let g=a.forwardRef((e,r)=>{let{className:s,children:a,...n}=e,{error:i,formMessageId:o}=useFormField(),d=i?String(null==i?void 0:i.message):a;return d?(0,t.jsx)("p",{ref:r,id:o,className:(0,l.cn)("text-sm font-medium text-destructive",s),...n,children:d}):null});g.displayName="FormMessage"},37799:function(e,r,s){"use strict";s.d(r,{I:function(){return i}});var t=s(27573),a=s(7653),n=s(94619);let i=a.forwardRef((e,r)=>{let{className:s,type:a,...i}=e;return(0,t.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...i})});i.displayName="Input"},22062:function(e,r,s){"use strict";s.d(r,{_:function(){return d}});var t=s(27573),a=s(7653),n=s(41500),i=s(69484),l=s(94619);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.f,{ref:r,className:(0,l.cn)(o(),s),...a})});d.displayName=n.f.displayName},89056:function(e,r,s){"use strict";s.r(r),s.d(r,{Separator:function(){return l}});var t=s(27573),a=s(7653),n=s(42530),i=s(94619);let l=a.forwardRef((e,r)=>{let{className:s,orientation:a="horizontal",decorative:l=!0,...o}=e;return(0,t.jsx)(n.f,{ref:r,decorative:l,orientation:a,className:(0,i.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",s),...o})});l.displayName=n.f.displayName},93598:function(e,r,s){"use strict";s.d(r,{g:function(){return i}});var t=s(27573),a=s(7653),n=s(94619);let i=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...a})});i.displayName="Textarea"}},function(e){e.O(0,[37,110,116,419,893,694,769,900,377,293,858,560],function(){return e(e.s=35512)}),_N_E=e.O()}]);